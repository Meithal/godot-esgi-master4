<!DOCTYPE html>
<html>

<head>
    <title>XOR Learning Visualization</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #1a1a1a;
            color: #eee;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        #canvas-container {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            background: #252525;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        #controls {
            padding: 20px;
            background: #333;
            display: flex;
            align-items: center;
            gap: 20px;
            border-top: 1px solid #444;
        }

        #scrubber {
            flex-grow: 1;
            cursor: pointer;
        }

        .stat-box {
            background: #444;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            min-width: 150px;
            text-align: center;
        }

        .legend {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #aaa;
            margin-left: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <div id="canvas-container">
        <canvas id="netCanvas"></canvas>
    </div>
    <div id="controls">
        <button id="btnPlay">Play</button>
        <input type="range" id="scrubber" min="0" max="100" value="0">
        <div class="stat-box" id="infoEpoch">Epoch: 0</div>
        <div class="stat-box" id="infoLoss">Loss: 0.000</div>
        <div class="stat-box" id="infoAcc">Acc: 0%</div>

        <div class="legend">
            <div class="legend-item">
                <div class="dot" style="background:cyan"></div>+Val
            </div>
            <div class="legend-item">
                <div class="dot" style="background:magenta"></div>-Val
            </div>
            <div class="legend-item">
                <div class="dot" style="background:#0f0"></div>+W
            </div>
            <div class="legend-item">
                <div class="dot" style="background:#f00"></div>-W
            </div>
        </div>
    </div>

    <script>
        // Data injected by python
        const snapshots = __SNAPSHOTS__;

        const canvas = document.getElementById('netCanvas');
        const ctx = canvas.getContext('2d');
        const scrubber = document.getElementById('scrubber');
        const btnPlay = document.getElementById('btnPlay');
        const infoEpoch = document.getElementById('infoEpoch');
        const infoLoss = document.getElementById('infoLoss');
        const infoAcc = document.getElementById('infoAcc');

        // Config
        let currentIdx = 0;
        let isPlaying = false;
        const width = 800;
        const height = 600;
        canvas.width = width;
        canvas.height = height;

        scrubber.max = snapshots.length - 1;

        // Hardcoded XOR positions
        const positions = {
            'x1': { x: 100, y: 200 }, 'x2': { x: 100, y: 400 },
            'h1': { x: 400, y: 200 }, 'h2': { x: 400, y: 400 },
            'o1': { x: 700, y: 200 }, 'o2': { x: 700, y: 400 }
        };

        function drawNeuron(name, x, y, value, bias) {
            ctx.beginPath();
            ctx.arc(x, y, 30, 0, Math.PI * 2);
            ctx.fillStyle = '#444';
            ctx.fill();

            // Value indicator (Inner circle color)
            const intensity = Math.min(Math.abs(value), 1.0);
            ctx.fillStyle = value > 0 ? `rgba(0, 255, 255, ${intensity})` : `rgba(255, 0, 255, ${intensity})`;
            ctx.beginPath();
            ctx.arc(x, y, 25, 0, Math.PI * 2);
            ctx.fill();

            // Text
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 14px monospace';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(name, x, y - 5);
            ctx.font = '10px monospace';
            ctx.fillText(value.toFixed(2), x, y + 15);

            // Bias ring
            if (Math.abs(bias) > 0.01) {
                ctx.beginPath();
                ctx.arc(x, y, 32, 0, Math.PI * 2);
                ctx.strokeStyle = bias > 0 ? '#0f0' : '#f00';
                ctx.lineWidth = Math.min(Math.abs(bias) * 5, 5);
                ctx.stroke();
            }
        }

        function drawConnection(fromPos, toPos, weight) {
            ctx.beginPath();
            ctx.moveTo(fromPos.x, fromPos.y);
            ctx.lineTo(toPos.x, toPos.y);
            ctx.strokeStyle = weight > 0 ? '#0f0' : '#f00';
            ctx.lineWidth = Math.min(Math.abs(weight) * 5, 10);
            ctx.globalAlpha = 0.6;
            ctx.stroke();
            ctx.globalAlpha = 1.0;
        }

        function render(idx) {
            const snap = snapshots[idx];
            ctx.clearRect(0, 0, width, height);

            // Draw connections first
            snap.connections.forEach(c => {
                const p1 = positions[c.from];
                const p2 = positions[c.to];
                if (p1 && p2) drawConnection(p1, p2, c.weight);
            });

            // Draw neurons
            snap.neurons.forEach(n => {
                const p = positions[n.name];
                if (p) drawNeuron(n.name, p.x, p.y, n.value, n.bias);
            });

            // Update UI
            infoEpoch.textContent = `Epoch: ${snap.epoch}`;
            infoLoss.textContent = `Loss: ${snap.loss.toFixed(4)}`;
            infoAcc.textContent = `Acc: ${(snap.accuracy * 100).toFixed(0)}%`;
            scrubber.value = idx;
        }

        // Loop
        function loop() {
            if (isPlaying) {
                if (currentIdx < snapshots.length - 1) {
                    currentIdx++;
                    render(currentIdx);
                    requestAnimationFrame(loop);
                } else {
                    isPlaying = false;
                    btnPlay.textContent = "Play";
                }
            }
        }

        // Events
        btnPlay.onclick = () => {
            if (currentIdx >= snapshots.length - 1) currentIdx = 0;
            isPlaying = !isPlaying;
            btnPlay.textContent = isPlaying ? "Pause" : "Play";
            if (isPlaying) loop();
        };

        scrubber.oninput = (e) => {
            isPlaying = false;
            btnPlay.textContent = "Play";
            currentIdx = parseInt(e.target.value);
            render(currentIdx);
        };

        // Init
        render(0);

    </script>
</body>

</html>